:81 {
        # Log configuration for debugging
        log {
                output file /home/z/my-project/caddy-access.log
                format json
        }

        @transform_port_query {
                query XTransformPort=*
        }

        handle @transform_port_query {
                reverse_proxy localhost:{query.XTransformPort} {
                        header_up Host {host}
                        header_up X-Forwarded-For {remote_host}
                        header_up X-Forwarded-Proto {scheme}
                        header_up X-Real-IP {remote_host}
                        transport http {
                                dial_timeout 30s
                                response_header_timeout 30s
                        }
                }
        }

        handle {
                reverse_proxy localhost:3000 {
                        header_up Host {host}
                        header_up X-Forwarded-For {remote_host}
                        header_up X-Forwarded-Proto {scheme}
                        header_up X-Real-IP {remote_host}
                        transport http {
                                dial_timeout 30s
                                response_header_timeout 30s
                        }
                }
        }
}
