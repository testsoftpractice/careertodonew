generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
  directUrl = env("DIRECT_URL")
}

model Agreement {
  id        String    @id
  userId    String
  projectId String?
  title     String
  content   String
  signed    Boolean   @default(false)
  signedAt  DateTime?
  createdAt DateTime  @default(now())
  updatedAt DateTime
  Project   Project?  @relation(fields: [projectId], references: [id])
  User      User      @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@index([signed])
  @@index([userId])
}

model AuditLog {
  id        String   @id
  userId    String
  action    String
  entity    String
  entityId  String
  details   String?
  createdAt DateTime @default(now())
  User      User     @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@index([createdAt])
  @@index([entity])
  @@index([action])
  @@index([userId])
}

model Business {
  id             String           @id
  name           String
  description    String?
  industry       String?
  location       String?
  website        String?
  logo           String?
  size           String?
  status         String           @default("PENDING")
  verifiedAt     DateTime?
  public         Boolean          @default(false)
  ownerId        String
  createdAt      DateTime         @default(now())
  updatedAt      DateTime
  User           User             @relation(fields: [ownerId], references: [id], onDelete: Cascade)
  BusinessMember BusinessMember[]
  Job            Job[]
  Project        Project[]

  @@index([status])
  @@index([ownerId])
}

model BusinessMember {
  id          String   @id
  businessId  String
  userId      String
  role        String   @default("TEAM_MEMBER")
  permissions String?
  joinedAt    DateTime @default(now())
  User        User     @relation(fields: [userId], references: [id], onDelete: Cascade)
  Business    Business @relation(fields: [businessId], references: [id], onDelete: Cascade)

  @@unique([businessId, userId])
  @@index([role])
  @@index([userId])
  @@index([businessId])
}

model CollaborationRequest {
  id                                     String   @id
  fromId                                 String
  toId                                   String
  type                                   String   @default("PROJECT")
  status                                 String   @default("PENDING")
  message                                String?
  projectId                              String?
  createdAt                              DateTime @default(now())
  updatedAt                              DateTime
  User_CollaborationRequest_toIdToUser   User     @relation("CollaborationRequest_toIdToUser", fields: [toId], references: [id], onDelete: Cascade)
  User_CollaborationRequest_fromIdToUser User     @relation("CollaborationRequest_fromIdToUser", fields: [fromId], references: [id], onDelete: Cascade)

  @@index([type])
  @@index([status])
  @@index([toId])
  @@index([fromId])
}

model Department {
  id            String          @id
  projectId     String
  name          String
  headId        String?
  User          User?           @relation(fields: [headId], references: [id])
  Project       Project         @relation(fields: [projectId], references: [id], onDelete: Cascade)
  ProjectMember ProjectMember[]

  @@index([headId])
  @@index([projectId])
}

model Education {
  id          String   @id
  userId      String
  school      String
  degree      String
  field       String?
  gpa         Float?
  description String?
  startDate   DateTime
  endDate     DateTime
  createdAt   DateTime @default(now())
  updatedAt   DateTime
  User        User     @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@index([startDate])
  @@index([userId])
}

model Experience {
  id          String    @id
  userId      String
  title       String
  company     String?
  location    String?
  description String?
  startDate   DateTime
  endDate     DateTime?
  current     Boolean   @default(false)
  skills      String?
  createdAt   DateTime  @default(now())
  updatedAt   DateTime
  User        User      @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@index([current])
  @@index([startDate])
  @@index([userId])
}

model Investment {
  id              String    @id
  userId          String
  projectId       String
  amount          Float
  type            String
  status          String    @default("PENDING")
  equity          Float?
  projectedReturn Float?
  investedAt      DateTime?
  terms           String?
  expiresAt       DateTime?
  agreementId     String?
  fundedAt        DateTime?
  createdAt       DateTime  @default(now())
  updatedAt       DateTime
  Project         Project   @relation(fields: [projectId], references: [id], onDelete: Cascade)
  User            User      @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@index([projectId])
  @@index([status])
  @@index([userId])
}

model Job {
  id              String           @id
  userId          String
  businessId      String?
  title           String
  description     String?
  type            String           @default("FULL_TIME")
  employmentType  String           @default("FULL_TIME")
  location        String?
  salary          String?
  salaryMin       Float?
  salaryMax       Float?
  department      String?
  status          String?
  views           Int              @default(0)
  deadline        DateTime?
  published       Boolean          @default(false)
  publishedAt     DateTime?
  metadata        String?          @default("{}")
  approvalStatus  String           @default("DRAFT")
  approvedAt      DateTime?
  approvedBy      String?
  rejectionReason String?
  reviewComments  String?
  submissionDate  DateTime?
  createdAt       DateTime         @default(now())
  updatedAt       DateTime
  Business        Business?        @relation(fields: [businessId], references: [id], onDelete: Cascade)
  User            User             @relation(fields: [userId], references: [id], onDelete: Cascade)
  JobApplication  JobApplication[]
  JobApproval     JobApproval[]
  Notification    Notification[]

  @@index([published])
  @@index([businessId])
  @@index([userId])
}

model JobApplication {
  id        String   @id
  jobId     String
  userId    String
  status    String   @default("PENDING")
  createdAt DateTime @default(now())
  updatedAt DateTime
  User      User     @relation(fields: [userId], references: [id], onDelete: Cascade)
  Job       Job      @relation(fields: [jobId], references: [id], onDelete: Cascade)

  @@index([status])
  @@index([userId])
  @@index([jobId])
}

model JobApproval {
  id         String   @id
  jobId      String
  adminId    String
  status     String
  comments   String?
  reviewedAt DateTime @default(now())
  createdAt  DateTime @default(now())
  updatedAt  DateTime
  User       User     @relation(fields: [adminId], references: [id])
  Job        Job      @relation(fields: [jobId], references: [id], onDelete: Cascade)

  @@index([status])
  @@index([adminId])
  @@index([jobId])
}

model Leaderboard {
  id        String   @id
  userId    String
  category  String
  score     Float
  rank      Int
  createdAt DateTime @default(now())
  updatedAt DateTime
  User      User     @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@unique([userId, category])
  @@index([rank])
  @@index([category])
}

model LeaveRequest {
  id              String    @id
  userId          String
  projectId       String?
  leaveType       String
  startDate       DateTime
  endDate         DateTime
  reason          String
  status          String    @default("PENDING")
  rejectionReason String?
  reviewedBy      String?
  reviewedAt      DateTime?
  createdAt       DateTime  @default(now())
  updatedAt       DateTime
  Project         Project?  @relation(fields: [projectId], references: [id])
  User            User      @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@index([endDate])
  @@index([startDate])
  @@index([status])
  @@index([projectId])
  @@index([userId])
}

model Message {
  id                            String   @id
  fromUserId                    String
  toUserId                      String
  content                       String
  read                          Boolean  @default(false)
  createdAt                     DateTime @default(now())
  User_Message_toUserIdToUser   User     @relation("Message_toUserIdToUser", fields: [toUserId], references: [id], onDelete: Cascade)
  User_Message_fromUserIdToUser User     @relation("Message_fromUserIdToUser", fields: [fromUserId], references: [id], onDelete: Cascade)

  @@index([read])
  @@index([toUserId])
  @@index([fromUserId])
}

model Milestone {
  id          String    @id
  projectId   String
  title       String
  description String?
  status      String    @default("NOT_STARTED")
  dueDate     DateTime
  completedAt DateTime?
  metrics     String?
  createdAt   DateTime  @default(now())
  updatedAt   DateTime
  Project     Project   @relation(fields: [projectId], references: [id], onDelete: Cascade)

  @@index([dueDate])
  @@index([status])
  @@index([projectId])
}

model Notification {
  id        String   @id
  userId    String
  type      String
  title     String
  message   String
  link      String?
  priority  String   @default("MEDIUM")
  read      Boolean  @default(false)
  projectId String?
  taskId    String?
  jobId     String?
  createdAt DateTime @default(now())
  Job       Job?     @relation(fields: [jobId], references: [id])
  Task      Task?    @relation(fields: [taskId], references: [id])
  Project   Project? @relation(fields: [projectId], references: [id])
  User      User     @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@index([jobId])
  @@index([taskId])
  @@index([projectId])
  @@index([type])
  @@index([read])
  @@index([userId])
}

model PasswordResetToken {
  id        String    @id
  userId    String
  token     String    @unique
  expiresAt DateTime
  used      Boolean   @default(false)
  usedAt    DateTime?
  createdAt DateTime  @default(now())
  User      User      @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@index([expiresAt])
  @@index([token])
  @@index([userId])
}

model PersonalTask {
  id          String    @id
  userId      String
  title       String
  description String?
  status      String    @default("TODO")
  priority    String    @default("MEDIUM")
  dueDate     DateTime?
  completedAt DateTime?
  createdAt   DateTime  @default(now())
  updatedAt   DateTime
  User        User      @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@index([priority])
  @@index([status])
  @@index([userId])
}

model PointTransaction {
  id          String   @id
  userId      String
  points      Int
  source      String
  description String?
  metadata    String?
  createdAt   DateTime @default(now())
  updatedAt   DateTime
  User        User     @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@index([createdAt])
  @@index([source])
  @@index([userId])
}

model ProfessionalRecord {
  id          String    @id
  userId      String
  recordType  String?
  title       String
  description String
  startDate   DateTime
  endDate     DateTime?
  metadata    String?
  verified    Boolean   @default(false)
  createdAt   DateTime  @default(now())
  updatedAt   DateTime
  User        User      @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@index([verified])
  @@index([userId])
}

model Project {
  id                String            @id
  name              String
  description       String?
  status            String            @default("IDEA")
  stage             String            @default("IDEA")
  ownerId           String
  businessId        String?
  universityId      String?
  startDate         DateTime?
  endDate           DateTime?
  budget            Float?
  category          String?
  tags              String?
  imageUrl          String?
  progress          Float             @default(0)
  seekingInvestment Boolean           @default(false)
  published         Boolean           @default(false)
  publishedAt       DateTime?
  approvalStatus    String            @default("PENDING")
  approvalDate      DateTime?
  approvedAt        DateTime?
  approvedBy        String?
  terminationReason String?
  terminationDate   DateTime?
  reviewComments    String?
  submissionDate    DateTime?
  createdAt         DateTime          @default(now())
  updatedAt         DateTime
  Agreement         Agreement[]
  Department        Department[]
  Investment        Investment[]
  LeaveRequest      LeaveRequest[]
  Milestone         Milestone[]
  Notification      Notification[]
  University        University?       @relation(fields: [universityId], references: [id])
  Business          Business?         @relation(fields: [businessId], references: [id])
  User              User              @relation(fields: [ownerId], references: [id], onDelete: Cascade)
  ProjectApproval   ProjectApproval[]
  ProjectMember     ProjectMember[]
  Rating            Rating[]
  Task              Task[]
  TimeEntry         TimeEntry[]
  Vacancy           Vacancy[]
  WorkSession       WorkSession[]

  @@index([published])
  @@index([progress])
  @@index([category])
  @@index([stage])
  @@index([status])
  @@index([businessId])
  @@index([ownerId])
}

model ProjectApproval {
  id         String   @id
  projectId  String
  adminId    String
  status     String
  comments   String?
  reviewedAt DateTime @default(now())
  createdAt  DateTime @default(now())
  updatedAt  DateTime
  User       User     @relation(fields: [adminId], references: [id])
  Project    Project  @relation(fields: [projectId], references: [id], onDelete: Cascade)

  @@index([status])
  @@index([adminId])
  @@index([projectId])
}

model ProjectMember {
  id           String      @id
  projectId    String
  userId       String
  role         String      @default("TEAM_MEMBER")
  accessLevel  String      @default("VIEW")
  departmentId String?
  joinedAt     DateTime    @default(now())
  Department   Department? @relation(fields: [departmentId], references: [id])
  User         User        @relation(fields: [userId], references: [id], onDelete: Cascade)
  Project      Project     @relation(fields: [projectId], references: [id], onDelete: Cascade)

  @@unique([projectId, userId])
  @@index([departmentId])
  @@index([accessLevel])
  @@index([userId])
  @@index([projectId])
}

model Rating {
  id                           String   @id
  fromUserId                   String
  toUserId                     String
  type                         String
  score                        Int
  comment                      String?
  projectId                    String?
  createdAt                    DateTime @default(now())
  updatedAt                    DateTime
  Project                      Project? @relation(fields: [projectId], references: [id])
  User_Rating_toUserIdToUser   User     @relation("Rating_toUserIdToUser", fields: [toUserId], references: [id], onDelete: Cascade)
  User_Rating_fromUserIdToUser User     @relation("Rating_fromUserIdToUser", fields: [fromUserId], references: [id], onDelete: Cascade)

  @@index([type])
  @@index([toUserId])
  @@index([fromUserId])
}

model Skill {
  id           String   @id
  userId       String
  name         String
  level        String   @default("INTERMEDIATE")
  endorsements Int      @default(0)
  createdAt    DateTime @default(now())
  updatedAt    DateTime
  User         User     @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@unique([userId, name])
  @@index([level])
  @@index([userId])
}

model SubTask {
  id        String   @id
  taskId    String
  title     String
  completed Boolean  @default(false)
  sortOrder Int      @default(0)
  createdAt DateTime @default(now())
  updatedAt DateTime
  Task      Task     @relation(fields: [taskId], references: [id], onDelete: Cascade)

  @@index([taskId])
}

model Task {
  id                                              String           @id
  projectId                                       String?
  title                                           String
  description                                     String?
  status                                          String           @default("TODO")
  priority                                        String           @default("MEDIUM")
  currentStepId                                   String?          @default("1")
  assignedBy                                      String
  assignedTo                                      String?
  dueDate                                         DateTime?
  completedAt                                     DateTime?
  estimatedHours                                  Float?
  actualHours                                     Float?
  createdAt                                       DateTime         @default(now())
  updatedAt                                       DateTime
  Notification                                    Notification[]
  SubTask                                         SubTask[]
  User_Task_assignedToToUser                      User?            @relation("Task_assignedToToUser", fields: [assignedTo], references: [id])
  User_Task_assignedByToUser                      User             @relation("Task_assignedByToUser", fields: [assignedBy], references: [id], onDelete: Cascade)
  Project                                         Project?         @relation(fields: [projectId], references: [id])
  TaskAssignee                                    TaskAssignee[]
  TaskComment                                     TaskComment[]
  TaskDependency_TaskDependency_dependsOnIdToTask TaskDependency[] @relation("TaskDependency_dependsOnIdToTask")
  TaskDependency_TaskDependency_taskIdToTask      TaskDependency[] @relation("TaskDependency_taskIdToTask")
  TaskStep                                        TaskStep[]
  TimeEntry                                       TimeEntry[]
  WorkSession                                     WorkSession[]

  @@index([assignedTo])
  @@index([dueDate])
  @@index([createdAt])
  @@index([currentStepId])
  @@index([priority])
  @@index([status])
  @@index([projectId])
  @@index([projectId, priority, status])
  @@index([projectId, status])
}

model TaskAssignee {
  id         String   @id
  taskId     String
  userId     String
  assignedAt DateTime @default(now())
  sortOrder  Int      @default(0)
  User       User     @relation(fields: [userId], references: [id], onDelete: Cascade)
  Task       Task     @relation(fields: [taskId], references: [id], onDelete: Cascade)

  @@unique([taskId, userId])
  @@index([userId])
  @@index([taskId])
}

model TaskComment {
  id        String   @id
  taskId    String
  userId    String
  content   String
  createdAt DateTime @default(now())
  updatedAt DateTime
  User      User     @relation(fields: [userId], references: [id], onDelete: Cascade)
  Task      Task     @relation(fields: [taskId], references: [id], onDelete: Cascade)

  @@index([userId])
  @@index([taskId])
}

model TaskDependency {
  id                                    String @id
  taskId                                String
  dependsOnId                           String
  Task_TaskDependency_dependsOnIdToTask Task   @relation("TaskDependency_dependsOnIdToTask", fields: [dependsOnId], references: [id], onDelete: Cascade)
  Task_TaskDependency_taskIdToTask      Task   @relation("TaskDependency_taskIdToTask", fields: [taskId], references: [id], onDelete: Cascade)

  @@unique([taskId, dependsOnId])
  @@index([dependsOnId])
  @@index([taskId])
}

model TaskStep {
  id          String   @id
  taskId      String
  stepNumber  String
  name        String
  description String?
  movedBy     String
  movedAt     DateTime @default(now())
  User        User     @relation(fields: [movedBy], references: [id], onDelete: Cascade)
  Task        Task     @relation(fields: [taskId], references: [id], onDelete: Cascade)

  @@index([stepNumber])
  @@index([taskId])
}

model TimeEntry {
  id            String       @id
  taskId        String?
  projectId     String?
  userId        String
  date          DateTime
  hours         Float
  description   String?
  billable      Boolean      @default(false)
  hourlyRate    Float?
  workSessionId String?
  WorkSession   WorkSession? @relation(fields: [workSessionId], references: [id])
  User          User         @relation(fields: [userId], references: [id], onDelete: Cascade)
  Project       Project?     @relation(fields: [projectId], references: [id])
  Task          Task?        @relation(fields: [taskId], references: [id])

  @@index([date])
  @@index([workSessionId])
  @@index([projectId])
  @@index([taskId])
  @@index([userId])
}

model University {
  id                 String    @id
  name               String
  code               String    @unique
  description        String?
  location           String?
  website            String?
  rankingScore       Float?
  rankingPosition    Int?
  totalStudents      Int?
  verificationStatus String    @default("PENDING")
  totalProjects      Int       @default(0)
  createdAt          DateTime  @default(now())
  updatedAt          DateTime
  Project            Project[]
  User               User[]

  @@index([verificationStatus])
  @@index([code])
}

model User {
  id                                                     String                 @id
  email                                                  String                 @unique
  password                                               String
  name                                                   String
  avatar                                                 String?
  role                                                   String
  verificationStatus                                     String                 @default("PENDING")
  universityId                                           String?
  major                                                  String?
  graduationYear                                         Int?
  bio                                                    String?
  location                                               String?
  linkedinUrl                                            String?
  portfolioUrl                                           String?
  emailVerified                                          Boolean                @default(false)
  emailVerifiedAt                                        DateTime?
  mobileNumber                                           String?
  executionScore                                         Float?
  collaborationScore                                     Float?
  leadershipScore                                        Float?
  ethicsScore                                            Float?
  reliabilityScore                                       Float?
  progressionLevel                                       String?
  totalPoints                                            Int                    @default(0)
  loginAttempts                                          Int                    @default(0)
  lockedAt                                               DateTime?
  lastPasswordChange                                     DateTime?
  lastLoginAt                                            DateTime?
  department                                             String?
  projectLeads                                           Int                    @default(0)
  createdAt                                              DateTime               @default(now())
  updatedAt                                              DateTime
  Agreement                                              Agreement[]
  AuditLog                                               AuditLog[]
  Business                                               Business[]
  BusinessMember                                         BusinessMember[]
  CollaborationRequest_CollaborationRequest_toIdToUser   CollaborationRequest[] @relation("CollaborationRequest_toIdToUser")
  CollaborationRequest_CollaborationRequest_fromIdToUser CollaborationRequest[] @relation("CollaborationRequest_fromIdToUser")
  Department                                             Department[]
  Education                                              Education[]
  Experience                                             Experience[]
  Investment                                             Investment[]
  Job                                                    Job[]
  JobApplication                                         JobApplication[]
  JobApproval                                            JobApproval[]
  Leaderboard                                            Leaderboard[]
  LeaveRequest                                           LeaveRequest[]
  Message_Message_toUserIdToUser                         Message[]              @relation("Message_toUserIdToUser")
  Message_Message_fromUserIdToUser                       Message[]              @relation("Message_fromUserIdToUser")
  Notification                                           Notification[]
  PasswordResetToken                                     PasswordResetToken[]
  PersonalTask                                           PersonalTask[]
  PointTransaction                                       PointTransaction[]
  ProfessionalRecord                                     ProfessionalRecord[]
  Project                                                Project[]
  ProjectApproval                                        ProjectApproval[]
  ProjectMember                                          ProjectMember[]
  Rating_Rating_toUserIdToUser                           Rating[]               @relation("Rating_toUserIdToUser")
  Rating_Rating_fromUserIdToUser                         Rating[]               @relation("Rating_fromUserIdToUser")
  Skill                                                  Skill[]
  Task_Task_assignedToToUser                             Task[]                 @relation("Task_assignedToToUser")
  Task_Task_assignedByToUser                             Task[]                 @relation("Task_assignedByToUser")
  TaskAssignee                                           TaskAssignee[]
  TaskComment                                            TaskComment[]
  TaskStep                                               TaskStep[]
  TimeEntry                                              TimeEntry[]
  University                                             University?            @relation(fields: [universityId], references: [id])
  VerificationRequest                                    VerificationRequest[]
  WorkSession                                            WorkSession[]

  @@index([verificationStatus])
  @@index([universityId])
  @@index([role])
  @@index([email])
}

model Vacancy {
  id               String   @id
  projectId        String
  title            String
  description      String?
  type             String   @default("FULL_TIME")
  skills           String?
  slots            Int      @default(1)
  filled           Int      @default(0)
  responsibilities String?
  requirements     String?
  expertise        String?
  salaryMin        Float?
  salaryMax        Float?
  location         String?
  experience       String?
  status           String   @default("OPEN")
  createdAt        DateTime @default(now())
  updatedAt        DateTime
  Project          Project  @relation(fields: [projectId], references: [id], onDelete: Cascade)

  @@index([status])
  @@index([type])
  @@index([projectId])
}

model VerificationRequest {
  id          String    @id
  userId      String
  type        String
  status      String    @default("PENDING")
  submittedAt DateTime  @default(now())
  createdAt   DateTime  @default(now())
  reviewedAt  DateTime?
  notes       String?
  reviewNote  String?
  requesterId String?
  priority    String?
  title       String?
  description String?
  projectId   String?
  User        User      @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@index([requesterId])
  @@index([status])
  @@index([userId])
}

model WorkSession {
  id               String      @id
  userId           String
  projectId        String?
  taskId           String?
  type             String      @default("ONSITE")
  notes            String?
  checkInLocation  String?
  checkOutLocation String?
  startTime        DateTime
  endTime          DateTime?
  duration         Int?
  TimeEntry        TimeEntry[]
  Task             Task?       @relation(fields: [taskId], references: [id])
  Project          Project?    @relation(fields: [projectId], references: [id])
  User             User        @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@index([startTime])
  @@index([taskId])
  @@index([projectId])
  @@index([userId])
}
