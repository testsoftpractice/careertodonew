  @@index([type])
  @@index([createdAt])
}
}
  @@unique([fromUserId, toUserId, type, projectId]) // Prevent duplicate ratings

// This is your Prisma schema file,
// learn more about it in the docs: https://pris.ly/d/prisma-schema

generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "sqlite"
  url      = env("DATABASE_URL")
}

// ============================================
// ENUMS
// ============================================

enum UserRole {
  STUDENT
  EMPLOYER
  INVESTOR
  UNIVERSITY_ADMIN
  PLATFORM_ADMIN
}

enum VerificationStatus {
  PENDING
  UNDER_REVIEW
  VERIFIED
  REJECTED
}

enum SkillLevel {
  BEGINNER
  INTERMEDIATE
  ADVANCED
  EXPERT
}

enum LeaveType {
  SICK_LEAVE
  PERSONAL_LEAVE
  VACATION
  EMERGENCY
  BEREAVEMENT
  MATERNITY
  PATERNITY
}

enum LeaveRequestStatus {
  PENDING
  APPROVED
  REJECTED
  CANCELLED
}

enum EmploymentType {
  FULL_TIME
  PART_TIME
  INTERNSHIP
  CONTRACT
}

enum ProjectStatus {
  IDEA
  UNDER_REVIEW
  FUNDING
  IN_PROGRESS
  COMPLETED
  CANCELLED
  ON_HOLD
}

enum TaskPriority {
  CRITICAL
  HIGH
  MEDIUM
  LOW
}

enum TaskStatus {
  BACKLOG
  TODO
  IN_PROGRESS
  REVIEW
  DONE
  BLOCKED
  CANCELLED
}

enum MilestoneStatus {
  NOT_STARTED
  IN_PROGRESS
  COMPLETED
  CANCELLED
}

enum RatingType {
  EXECUTION
  COLLABORATION
  LEADERSHIP
  ETHICS
  RELIABILITY
}

enum NotificationType {
  INFO
  SUCCESS
  WARNING
  ERROR
  TASK_ASSIGNED
  PROJECT_UPDATE
  VERIFICATION
  INVESTMENT
  MESSAGE
}

enum NotificationPriority {
  LOW
  MEDIUM
  HIGH
  URGENT
}

enum AuditAction {
  CREATE
  UPDATE
  DELETE
  VIEW
  LOGIN
  LOGOUT
}

enum UniversityVerificationStatus {
  PENDING
  UNDER_REVIEW
  VERIFIED
  SUSPENDED
  REJECTED
}

enum ProgressionLevel {
  CONTRIBUTOR
  SENIOR_CONTRIBUTOR
  TEAM_LEAD
  PROJECT_LEAD
}

enum BusinessRole {
  OWNER
  ADMIN
  HR_MANAGER
  PROJECT_MANAGER
  TEAM_LEAD
  RECRUITER
  TEAM_MEMBER
  VIEWER
}

enum ProjectRole {
  OWNER
  PROJECT_MANAGER
  TEAM_LEAD
  TEAM_MEMBER
  VIEWER
}

enum TaskAccessLevel {
  OWNER
  PROJECT_MANAGER
  VIEW
  COMMENT
}

// ============================================
// MODELS
// ============================================

model University {
  id                String                        @id @default(cuid())
  name              String
  code              String                        @unique
  description       String?
  location          String?
  website           String?
  rankingScore      Float?
  rankingPosition   Int?
  totalStudents     Int?
  verificationStatus UniversityVerificationStatus @default(PENDING)
  totalProjects     Int                           @default(0)

  // Relations
  users             User[]

  // Timestamps
  createdAt         DateTime                      @default(now())
  updatedAt         DateTime                      @updatedAt

  @@index([code])
  @@index([verificationStatus])
}

model User {
  id                    String             @id @default(cuid())
  email                 String             @unique
  password              String
  name                  String
  avatar                String?
  role                  UserRole
  verificationStatus    VerificationStatus @default(PENDING)

  // Student specific fields
  universityId          String?
  major                 String?
  graduationYear        Int?
  bio                   String?
  location              String?
  linkedinUrl           String?
  portfolioUrl          String?
  emailVerified         Boolean            @default(false)
  emailVerifiedAt       DateTime?

  // University specific fields
  university            University?        @relation(fields: [universityId], references: [id], onDelete: SetNull)

  // Business specific fields
  businessesOwned     Business[]           @relation("BusinessOwned")
  businessMemberships  BusinessMember[]

  // Scoring
  executionScore        Float?
  collaborationScore    Float?
  leadershipScore       Float?
  ethicsScore           Float?
  reliabilityScore      Float?
  progressionLevel      ProgressionLevel?
  totalPoints          Int            @default(0)

  // Account security
  loginAttempts        Int                @default(0)
  lockedAt             DateTime?
  lastPasswordChange   DateTime?

  // Relations
  skills                Skill[]
  experiences           Experience[]
  education             Education[]
  leaveRequests         LeaveRequest[]
  projectsOwned         Project[]          @relation("ProjectOwner")
  projectsMembered      ProjectMember[]
  tasksAssigned         Task[]             @relation("AssignedTasks")
  tasksCreated          Task[]             @relation("CreatedTasks")
  timeEntries           TimeEntry[]
  workSessions          WorkSession[]
  professionalRecords   ProfessionalRecord[]
  ratingsGiven          Rating[]           @relation("RatingsGiven")
  ratingsReceived       Rating[]           @relation("RatingsReceived")
  notifications         Notification[]
  auditLogs             AuditLog[]
  verificationRequests  VerificationRequest[]
  agreements            Agreement[]
  investments           Investment[]
  jobsPosted            Job[]
  jobApplications       JobApplication[]
  messagesSent          Message[]          @relation("MessagesSent")
  messagesReceived      Message[]          @relation("MessagesReceived")
  leaderboardEntries    Leaderboard[]
  pointTransactions   PointTransaction[]
  departmentsHeaded     Department[]
  personalTasks         PersonalTask[]
  taskStepsCreated     TaskStep[]         @relation("TaskStepsCreatedBy")
  taskComments          TaskComment[]      @relation("TaskComments")

  // Timestamps
  createdAt             DateTime           @default(now())
  updatedAt             DateTime           @updatedAt

  @@index([email])
  @@index([role])
  @@index([universityId])
  @@index([verificationStatus])
}

model Skill {
  id           String     @id @default(cuid())
  userId       String
  name         String
  level        SkillLevel @default(INTERMEDIATE)
  endorsements Int        @default(0)

  // Relations
  user         User       @relation(fields: [userId], references: [id], onDelete: Cascade)

  // Timestamps
  createdAt    DateTime   @default(now())
  updatedAt    DateTime   @updatedAt

  @@unique([userId, name])
  @@index([userId])
  @@index([level])
}

model Experience {
  id          String    @id @default(cuid())
  userId      String
  title       String
  company     String?
  location    String?
  description String?
  startDate   DateTime
  endDate     DateTime?
  current     Boolean   @default(false)
  skills      String?

  // Relations
  user        User      @relation(fields: [userId], references: [id], onDelete: Cascade)

  // Timestamps
  createdAt   DateTime  @default(now())
  updatedAt   DateTime  @updatedAt

  @@index([userId])
  @@index([startDate])
  @@index([current])
}

model Education {
  id          String   @id @default(cuid())
  userId      String
  school      String
  degree      String
  field       String?
  description String?
  startDate   DateTime
  endDate     DateTime

  // Relations
  user        User     @relation(fields: [userId], references: [id], onDelete: Cascade)

  // Timestamps
  createdAt   DateTime @default(now())
  updatedAt   DateTime @updatedAt

  @@index([userId])
  @@index([startDate])
}

model LeaveRequest {
  id              String              @id @default(cuid())
  userId          String

  leaveType       LeaveType
  startDate       DateTime
  endDate         DateTime
  reason          String
  status          LeaveRequestStatus  @default(PENDING)
  rejectionReason String?

  // Approval Info
  reviewedBy      String?
  reviewedAt      DateTime?

  // Relations
  user            User                @relation(fields: [userId], references: [id], onDelete: Cascade)

  // Timestamps
  createdAt       DateTime            @default(now())
  updatedAt       DateTime            @updatedAt

  @@index([userId])
  @@index([status])
  @@index([startDate])
  @@index([endDate])
}

model Project {
  id                String       @id @default(cuid())
  name              String
  description       String?
  status            ProjectStatus @default(IDEA)

  // Owner
  ownerId           String
  businessId        String?

  // Additional fields
  startDate         DateTime?
  endDate           DateTime?
  budget            Float?
  category          String?

  // Relations
  owner             User         @relation("ProjectOwner", fields: [ownerId], references: [id], onDelete: Cascade)
  business          Business?     @relation("ProjectBusiness", fields: [businessId], references: [id], onDelete: SetNull)
  members           ProjectMember[]
  tasks             Task[]
  milestones         Milestone[]
  departments       Department[]
  vacancies         Vacancy[]
  ratings           Rating[]
  agreements        Agreement[]

  // Timestamps
  createdAt         DateTime     @default(now())
  updatedAt         DateTime     @updatedAt

  @@index([ownerId])
  @@index([businessId])
  @@index([status])
}

model ProjectMember {
  id          String         @id @default(cuid())
  projectId   String
  userId      String
  role        ProjectRole    @default(TEAM_MEMBER)
  accessLevel TaskAccessLevel @default(VIEW)
  joinedAt    DateTime       @default(now())

  // Relations
  project     Project        @relation(fields: [projectId], references: [id], onDelete: Cascade)
  user        User           @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@unique([projectId, userId])
  @@index([projectId])
  @@index([userId])
  @@index([accessLevel])
}

model Task {
  id            String      @id @default(cuid())
  projectId     String?
  title         String
  description   String?

  // Task management
  status        TaskStatus  @default(TODO)
  priority      TaskPriority @default(MEDIUM)
  currentStepId String?     @default("1")

  // Assignments
  assignedTo    String?
  assignedBy    String

  // Dates
  dueDate       DateTime?
  completedAt   DateTime?
  estimatedHours Float?
  actualHours   Float?

  // Relations
  project       Project?    @relation(fields: [projectId], references: [id], onDelete: SetNull)
  assignee      User?       @relation("AssignedTasks", fields: [assignedTo], references: [id], onDelete: SetNull)
  creator       User        @relation("CreatedTasks", fields: [assignedBy], references: [id], onDelete: Cascade)
  subTasks      SubTask[]
  timeEntries   TimeEntry[]
  dependencies  TaskDependency[] @relation("DependentTasks")
  blockers      TaskDependency[] @relation("BlockingTasks")
  steps         TaskStep[]
  comments      TaskComment[]

  // Timestamps
  createdAt     DateTime    @default(now())
  updatedAt     DateTime    @updatedAt

  // Indexes
  @@index([projectId, status])  // For project task lists
  @@index([assignedTo, status]) // For user task lists
  @@index([projectId, priority, status]) // For prioritized task lists
  @@index([projectId])
  @@index([assignedTo])
  @@index([status])
  @@index([priority])
  @@index([currentStepId])
  @@index([createdAt])
  @@index([dueDate])
}

model SubTask {
  id        String   @id @default(cuid())
  taskId    String
  title     String
  completed Boolean  @default(false)
  sortOrder Int      @default(0)

  // Relations
  task      Task     @relation(fields: [taskId], references: [id], onDelete: Cascade)

  // Timestamps
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  @@index([taskId])
}

model TaskDependency {
  id           String @id @default(cuid())
  taskId       String
  dependsOnId  String

  // Relations
  task         Task   @relation("DependentTasks", fields: [taskId], references: [id], onDelete: Cascade)
  dependsOn    Task   @relation("BlockingTasks", fields: [dependsOnId], references: [id], onDelete: Cascade)

  @@unique([taskId, dependsOnId])
  @@index([taskId])
  @@index([dependsOnId])
}

model Milestone {
  id          String          @id @default(cuid())
  projectId   String
  title       String
  description String?
  status      MilestoneStatus @default(NOT_STARTED)
  dueDate     DateTime
  completedAt DateTime?
  metrics     String?

  // Relations
  project     Project         @relation(fields: [projectId], references: [id], onDelete: Cascade)

  // Timestamps
  createdAt   DateTime        @default(now())
  updatedAt   DateTime        @updatedAt

  @@index([projectId])
  @@index([status])
  @@index([dueDate])
}

model Department {
  id        String   @id @default(cuid())
  projectId String
  name      String
  headId    String?

  // Relations
  project   Project  @relation(fields: [projectId], references: [id], onDelete: Cascade)
  head      User?    @relation(fields: [headId], references: [id], onDelete: SetNull)

  @@index([projectId])
  @@index([headId])
}

model Vacancy {
  id          String         @id @default(cuid())
  projectId   String
  title       String
  description String?
  type        EmploymentType @default(FULL_TIME)
  skills      String?
  slots       Int            @default(1)
  filled      Int            @default(0)

  // Relations
  project     Project        @relation(fields: [projectId], references: [id], onDelete: Cascade)

  // Timestamps
  createdAt   DateTime       @default(now())
  updatedAt   DateTime       @updatedAt

  @@index([projectId])
  @@index([type])
}

model TimeEntry {
  id        String   @id @default(cuid())
  taskId    String
  userId    String
  date      DateTime
  hours     Float
  description String?
  billable  Boolean  @default(false)
  hourlyRate Float?

  // Relations
  task      Task     @relation(fields: [taskId], references: [id], onDelete: Cascade)
  user      User     @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@index([taskId])
  @@index([userId])
  @@index([date])
}

model WorkSession {
  id        String   @id @default(cuid())
  userId    String
  startTime DateTime
  endTime   DateTime?
  duration  Int?     // in seconds

  // Relations
  user      User     @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@index([userId])
  @@index([startTime])
}

model ProfessionalRecord {
  id          String   @id @default(cuid())
  userId      String
  recordType  String?
  title       String
  description String
  startDate   DateTime
  endDate     DateTime?
  metadata    String?
  verified    Boolean  @default(false)

  // Relations
  user        User     @relation(fields: [userId], references: [id], onDelete: Cascade)

  // Timestamps
  createdAt   DateTime @default(now())
  updatedAt   DateTime @updatedAt

  @@index([userId])
  @@index([verified])
}

model Rating {
  id        String    @id @default(cuid())
  fromUserId String
  toUserId    String
  type       RatingType
  score      Int
  comment    String?

  // Relations
  fromUser   User      @relation("RatingsGiven", fields: [fromUserId], references: [id], onDelete: Cascade)
  toUser     User      @relation("RatingsReceived", fields: [toUserId], references: [id], onDelete: Cascade)
  project    Project?  @relation(fields: [projectId], references: [id], onDelete: SetNull)
  projectId  String?

  // Timestamps
  createdAt  DateTime  @default(now())
  updatedAt  DateTime  @updatedAt

  @@index([fromUserId])
  @@index([toUserId])

model Notification {
  id        String              @id @default(cuid())
  userId    String
  type      NotificationType
  title     String
  message   String
  priority  NotificationPriority @default(MEDIUM)
  read      Boolean             @default(false)

  // Relations
  user      User                @relation(fields: [userId], references: [id], onDelete: Cascade)

  // Timestamps
  createdAt DateTime            @default(now())

  @@index([userId])
  @@index([read])
  @@index([type])
}

model AuditLog {
  id        String     @id @default(cuid())
  userId    String
  action    AuditAction
  entity    String
  entityId  String
  details   String?

  // Relations
  user      User       @relation(fields: [userId], references: [id], onDelete: Cascade)

  // Timestamps
  createdAt DateTime   @default(now())

  @@index([userId])
  @@index([action])
  @@index([entity])
  @@index([createdAt])
}

model VerificationRequest {
  id          String             @id @default(cuid())
  userId      String
  type        String
  status      VerificationStatus @default(PENDING)
  submittedAt DateTime           @default(now())
  reviewedAt  DateTime?
  notes       String?
  requesterId String?

  // Relations
  user        User               @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@index([userId])
  @@index([status])
  @@index([requesterId])
}

model Agreement {
  id        String   @id @default(cuid())
  userId    String
  projectId String?
  title     String
  content   String
  signed    Boolean  @default(false)
  signedAt  DateTime?

  // Relations
  user      User     @relation(fields: [userId], references: [id], onDelete: Cascade)
  project   Project? @relation(fields: [projectId], references: [id], onDelete: SetNull)

  // Timestamps
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  @@index([userId])
  @@index([signed])
}

model Investment {
  id          String   @id @default(cuid())
  userId      String
  projectId   String?
  amount      Float
  type        String
  status      String  @default("PENDING")

  // Relations
  user        User     @relation(fields: [userId], references: [id], onDelete: Cascade)

  // Timestamps
  createdAt   DateTime @default(now())
  updatedAt   DateTime @updatedAt

  @@index([userId])
  @@index([status])
}

model Business {
  id                String             @id @default(cuid())
  name              String
  description       String?
  industry          String?
  location          String?
  website           String?
  logo              String?
  size              String?
  status            VerificationStatus @default(PENDING)
  verifiedAt        DateTime?

  // Owner
  ownerId           String
  owner             User               @relation("BusinessOwned", fields: [ownerId], references: [id], onDelete: Cascade)

  // Relations
  members           BusinessMember[]
  projects          Project[]          @relation("ProjectBusiness")
  jobs              Job[]              @relation("BusinessJobs")

  // Timestamps
  createdAt         DateTime           @default(now())
  updatedAt         DateTime           @updatedAt

  @@index([ownerId])
  @@index([status])
}

model BusinessMember {
  id          String     @id @default(cuid())
  businessId  String
  userId      String
  role        BusinessRole @default(TEAM_MEMBER)
  permissions String?    // JSON string for custom permissions
  joinedAt    DateTime   @default(now())

  // Relations
  business    Business   @relation(fields: [businessId], references: [id], onDelete: Cascade)
  user        User       @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@unique([businessId, userId])
  @@index([businessId])
  @@index([userId])
  @@index([role])
}

model Job {
  id          String         @id @default(cuid())
  userId      String
  businessId  String?
  title       String
  description String?
  type        EmploymentType @default(FULL_TIME)
  location    String?
  salary      String?
  published   Boolean        @default(false)
  publishedAt DateTime?

  // Relations
  user        User           @relation(fields: [userId], references: [id], onDelete: Cascade)
  business    Business?       @relation("BusinessJobs", fields: [businessId], references: [id], onDelete: Cascade)
  applications JobApplication[]

  // Timestamps
  createdAt   DateTime       @default(now())
  updatedAt   DateTime       @updatedAt

  @@index([userId])
  @@index([businessId])
  @@index([published])
}

model JobApplication {
  id        String   @id @default(cuid())
  jobId     String
  userId    String
  status    String  @default("PENDING")

  // Relations
  job       Job      @relation(fields: [jobId], references: [id], onDelete: Cascade)
  user      User     @relation(fields: [userId], references: [id], onDelete: Cascade)

  // Timestamps
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  @@index([jobId])
  @@index([userId])
  @@index([status])
}

model Message {
  id        String   @id @default(cuid())
  fromUserId String
  toUserId   String
  content   String
  read      Boolean  @default(false)

  // Relations
  fromUser  User     @relation("MessagesSent", fields: [fromUserId], references: [id], onDelete: Cascade)
  toUser    User     @relation("MessagesReceived", fields: [toUserId], references: [id], onDelete: Cascade)

  // Timestamps
  createdAt DateTime @default(now())

  @@index([fromUserId])
  @@index([toUserId])
  @@index([read])
}

model Leaderboard {
  id          String   @id @default(cuid())
  userId      String
  category    String
  score       Float
  rank        Int

  // Relations
  user        User     @relation(fields: [userId], references: [id], onDelete: Cascade)

  // Timestamps
  createdAt   DateTime @default(now())
  updatedAt   DateTime @updatedAt

  @@unique([userId, category])
  @@index([category])
  @@index([rank])
}

model PointTransaction {
  id          String     @id @default(cuid())
  userId      String
  points      Int
  source      String      // TASK_COMPLETION, COURSE_FINISHED, ACHIEVEMENT, etc.
  description String?
  metadata    String?     // JSON string for additional data

  // Relations
  user        User       @relation(fields: [userId], references: [id], onDelete: Cascade)

  // Timestamps
  createdAt   DateTime   @default(now())
  updatedAt   DateTime   @updatedAt

  @@index([userId])
  @@index([source])
  @@index([createdAt])
}

// Personal Task model for tasks without project association
model PersonalTask {
  id          String       @id @default(cuid())
  userId      String
  title       String
  description String?
  status      TaskStatus   @default(TODO)
  priority    TaskPriority @default(MEDIUM)
  dueDate     DateTime?
  completedAt DateTime?

  // Relations
  user        User         @relation(fields: [userId], references: [id], onDelete: Cascade)

  // Timestamps
  createdAt   DateTime     @default(now())
  updatedAt   DateTime     @updatedAt

  @@index([userId])
  @@index([status])
  @@index([priority])
}

// Task Step model for workflow tracking
model TaskStep {
  id          String   @id @default(cuid())
  taskId      String
  stepNumber  String
  name        String
  description String?
  movedBy     String
  movedAt     DateTime @default(now())

  // Relations
  task        Task     @relation(fields: [taskId], references: [id], onDelete: Cascade)
  mover       User     @relation("TaskStepsCreatedBy", fields: [movedBy], references: [id], onDelete: Cascade)

  @@index([taskId])
  @@index([stepNumber])
}

// Task Comment model for discussions
model TaskComment {
  id        String   @id @default(cuid())
  taskId    String
  userId    String
  content   String

  // Relations
  task      Task     @relation(fields: [taskId], references: [id], onDelete: Cascade)
  author    User     @relation("TaskComments", fields: [userId], references: [id], onDelete: Cascade)

  // Timestamps
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  @@index([taskId])
  @@index([userId])
}
